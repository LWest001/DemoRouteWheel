<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <style>
        #jspsych-animation-image{
            position: absolute;
            height: 256px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
    <script src='js_library/jspsych-6.1.0/jspsych.js'></script>
    <script src="js_library/jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
    <script src='js_library/jspsych-6.1.0/plugins/jspsych-instructions.js'></script>
    <script src='js_library/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js'></script>
    <script src='js_library/jspsych-6.1.0/plugins/jspsych-html-button-response.js'></script>
    <script src='js_library/jspsych-6.1.0/plugins/jspsych-mouse-reconstruction_leo.js'></script>
    <script src="js_library/underscore-min.js"></script>
    <script src="make_condition_leo.js"></script>
    <link href='js_library/jspsych-6.1.0/css/jspsych.css' rel='stylesheet' type="text/css">
    <script>
    var img_host = 'https://raw.githubusercontent.com/YibiaoLiang/onRoute/ISC2/'
    var radius = ['02', '04', '08', '16', '32'];
    var n_bin_onWheel = 18;
    var n_repetition = 3;
    var n_block = 5;
    var bin_startPoint = [];
    var basic_condition = [];
    for (i = 0; i < n_bin_onWheel; i++) {
        var bin_width = 360 / n_bin_onWheel;
        bin_startPoint.push(i * bin_width);
    }

    var jitter_option = [];
    for (i = 0; i < bin_width; i++) {
        jitter_option.push(i);
    }

   // assign value to each bin in each radius condition for each repetition
   for (r = 0; r < radius.length; r++) {
        for (b = 0; b < n_bin_onWheel; b++) {
            var shuffled_jitter = _.shuffle(jitter_option);
            for (rp = 0; rp < n_repetition; rp++) {
                var target_num = bin_startPoint[b] + shuffled_jitter[rp]
                var targetSeries = []
                for (backCount = 20; backCount>0; backCount--){
                    if (target_num-backCount+1>=0){
                        targetSeries.push(img_host + "ISC2/" + ('00000' + (target_num-backCount+1)).slice(-6) + '.jpg')     
                    } else {
                        targetSeries.push(img_host + "ISC2/" + ('00000' + (target_num-backCount+361)).slice(-6) + '.jpg')
                    }
                } 
                basic_condition.push({
                    radius: radius[r],
                    scene_num: ('00000' + (bin_startPoint[b] + shuffled_jitter[rp])).slice(-6).toString(),
                    wheel_path: img_host + "ISC2/", //Wheel path is the whole folder, so it the image can change base on the mouse, by Bill 11/23/2021 // change to IS2 by Leo 12/2/2021
                    //wheel_path: img_host+'Wheel'+wheel_num+'/wheel'+wheel_num+'_r'+radius[r]+'/', //Wheel path 
                    img_path: img_host + "ISC2/" + ('00000' + (bin_startPoint[b] + shuffled_jitter[rp])).slice(-6) + '.jpg' ,
                        // img_path: img_host+'Wheel'+wheel_num+'/wheel'+wheel_num+'_r'+radius[r]+'/'+
                        //         ('00000'+(bin_startPoint[b]+shuffled_jitter[rp])).slice(-6)+'.webp' 
                    target_series:targetSeries                        
                })
            }

        }
    }  

    var jsPsych = initJsPsych();

    var preload_trial = {
        type: jsPsychPreload,
        auto_preload: true
    }

    var start = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '',
        choices: ['Run demo']
    };

    var animation_trial = {
        type: jsPsychAnimation,
        stimuli: basic_condition[0].target_series,
        sequence_reps: 3,
        frame_time: 300,
    };

    var show_data = {
        type: jsPsychHtmlButtonResponse,
        stimulus: function() {
        var trial_data = jsPsych.data.getLastTrialData().values();
        var trial_json = JSON.stringify(trial_data, null, 2);
        return '<p style="margin-bottom:0px;"><strong>Trial data:</strong></p>'+
        '<pre style="margin-top:0px;text-align:left;">'+trial_json+'</pre>';
        },
        choices: ['Repeat demo']
    };

    var animation_data_loop = {
        timeline: [animation_trial, show_data],
        loop_function: function() {
        return true;
        }
    };

    if (typeof jsPsych !== "undefined") {
        jsPsych.run([preload_trial, start, animation_data_loop]);
    } else {
        document.body.innerHTML = '<div style="text-align:center; margin-top:50%; transform:translate(0,-50%);">You must be online to view the plugin demo.</div>';
    }
  
    
      </script>
  </head>
  <body></body>
</html>